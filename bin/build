#!/usr/bin/env bash
# -*- mode: bash; tab-width: 2; -*-
# vim: ts=2 sw=2 ft=bash noet

# $1 = payload JSON

# exit if anything fails
set -e

payload=$1

# source the common helper functions from NOS
. /opt/nos/common.sh

# initialize NOS
nos_init $@

# set our PATH to our node_modules/.bin
export PATH=$(payload 'code_dir')/node_modules/.bin:$PATH

# the build commands will need to be within the code_dir
cd $(payload 'code_dir')

# gulp rel
run_subprocess "generate release" "gulp rel"

# rel
print_bullet "Copying release into live code directory..."
rsync -a $(payload 'code_dir')/rel/ $(payload 'live_dir')
